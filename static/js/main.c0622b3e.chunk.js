(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{16:function(e,t,s){},17:function(e,t,s){},18:function(e,t,s){"use strict";s.r(t);var c=s(7),n=s.n(c),a=s(2),i=s(1),o=s.n(i),r="https://mate.academy/students-api";function l(e){return new Promise((function(t){setTimeout(t,e)}))}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return s&&(c.body=JSON.stringify(s),c.headers={"Content-Type":"application/json; charset=UTF-8"}),l(300).then((function(){return fetch(r+e,c)})).then((function(e){return e.json()}))}var j=function(e){return d(e)},m=function(e,t){return d(e,"POST",t)},u=function(e){return d(e,"DELETE")},b=s(0),h=o.a.createContext({}),O=function(e){var t=e.children,s=Object(i.useState)([]),c=Object(a.a)(s,2),n=c[0],o=c[1],r=Object(i.useState)(null),l=Object(a.a)(r,2),d=l[0],m=l[1],u=Object(i.useState)([]),O=Object(a.a)(u,2),x=O[0],f=O[1],v=Object(i.useState)(!1),N=Object(a.a)(v,2),p=N[0],g=N[1],y=Object(i.useState)(!1),C=Object(a.a)(y,2),S=C[0],P=C[1],E=Object(i.useState)(null),w=Object(a.a)(E,2),k=w[0],L=w[1],T=Object(i.useState)([]),U=Object(a.a)(T,2),F=U[0],I=U[1],B=Object(i.useState)(!1),W=Object(a.a)(B,2),D=W[0],M=W[1],A=Object(i.useState)(!1),_=Object(a.a)(A,2),J=_[0],q=_[1],G=Object(i.useState)(!1),R=Object(a.a)(G,2),Y=R[0],z=R[1];Object(i.useEffect)((function(){j("/users").then(o)}),[]),Object(i.useEffect)((function(){var e;null!==d&&void 0!==d&&d.id&&(f([]),g(!0),P(!1),(e=d.id,j("/posts?userId=".concat(e))).then(f).catch((function(){P(!0)})).finally((function(){g(!1)})))}),[d]),Object(i.useEffect)((function(){var e;null!==k&&void 0!==k&&k.id&&(z(!1),I([]),M(!0),q(!1),(e=k.id,j("/comments?postId=".concat(e))).then(I).catch((function(){q(!0)})).finally((function(){M(!1)})))}),[k]);var H={allUsers:n,selectedUser:d,setSelectedUser:m,arePostsLoading:p,posts:x,isPostsLoadingError:S,selectedPost:k,setSelectedPost:L,comments:F,setComments:I,areCommentsLoading:D,isCommentsLoadingError:J,isWritingComment:Y,setIsWritingComment:z};return Object(b.jsx)(h.Provider,{value:H,children:t})},x=(s(14),s(15),s(16),s(3)),f=s.n(x),v=function(){var e=Object(i.useContext)(h),t=e.posts,s=e.selectedPost,c=e.setSelectedPost;return Object(b.jsxs)("div",{"data-cy":"PostsList",children:[Object(b.jsx)("p",{className:"title",children:"Posts:"}),Object(b.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{className:"has-background-link-light",children:[Object(b.jsx)("th",{children:"#"}),Object(b.jsx)("th",{children:"Title"}),Object(b.jsx)("th",{children:" "})]})}),Object(b.jsx)("tbody",{children:t.map((function(e){return Object(b.jsxs)("tr",{"data-cy":"Post",children:[Object(b.jsx)("td",{"data-cy":"PostId",children:e.id}),Object(b.jsx)("td",{"data-cy":"PostTitle",children:e.title}),Object(b.jsx)("td",{className:"has-text-right is-vcentered",children:Object(b.jsx)("button",{type:"button","data-cy":"PostButton",className:f()("button is-link",{"is-light":(null===s||void 0===s?void 0:s.id)!==e.id}),onClick:function(){return function(e){(null===s||void 0===s?void 0:s.id)===e.id?c(null):c(e)}(e)},children:(null===s||void 0===s?void 0:s.id)===e.id?"Close":"Open"})})]},e.id)}))})]})]})},N=(s(17),function(){return Object(b.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(b.jsx)("div",{className:"Loader__content"})})}),p=s(8),g=function(){var e=Object(i.useState)(""),t=Object(a.a)(e,2),s=t[0],c=t[1],n=Object(i.useState)(!1),o=Object(a.a)(n,2),r=o[0],l=o[1],d=Object(i.useState)(""),j=Object(a.a)(d,2),u=j[0],O=j[1],x=Object(i.useState)(!1),v=Object(a.a)(x,2),N=v[0],g=v[1],y=Object(i.useState)(""),C=Object(a.a)(y,2),S=C[0],P=C[1],E=Object(i.useState)(!1),w=Object(a.a)(E,2),k=w[0],L=w[1],T=Object(i.useState)(!1),U=Object(a.a)(T,2),F=U[0],I=U[1],B=Object(i.useContext)(h),W=B.selectedPost,D=B.setComments,M=function(e){var t;(e.preventDefault(),l(!s.trim()),g(!u.trim()),L(!S.trim()),s.trim()&&u.trim()&&S.trim())&&(I(!0),(t={name:s,email:u,body:S,postId:null===W||void 0===W?void 0:W.id},m("/comments",t)).then((function(e){D((function(t){return[].concat(Object(p.a)(t),[e])})),P(""),I(!1)})))};return Object(b.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){return M(e)},children:[Object(b.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(b.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(b.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(b.jsx)("input",{type:"text",name:"name",value:s,onChange:function(e){return t=e.target.value,l(!1),void c(t);var t},id:"comment-author-name",placeholder:"Name Surname",className:f()("input",{"is-danger":r})}),Object(b.jsx)("span",{className:"icon is-small is-left",children:Object(b.jsx)("i",{className:"fas fa-user"})}),r&&Object(b.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(b.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),r&&Object(b.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(b.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(b.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(b.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(b.jsx)("input",{type:"text",name:"email",value:u,onChange:function(e){return t=e.target.value,g(!1),void O(t);var t},id:"comment-author-email",placeholder:"email@test.com",className:f()("input",{"is-danger":N})}),Object(b.jsx)("span",{className:"icon is-small is-left",children:Object(b.jsx)("i",{className:"fas fa-envelope"})}),N&&Object(b.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(b.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),N&&Object(b.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(b.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(b.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(b.jsx)("div",{className:"control",children:Object(b.jsx)("textarea",{id:"comment-body",name:"body",value:S,onChange:function(e){return t=e.target.value,L(!1),void P(t);var t},placeholder:"Type comment here",className:f()("textarea",{"is-danger":k})})}),k&&Object(b.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(b.jsxs)("div",{className:"field is-grouped",children:[Object(b.jsx)("div",{className:"control",children:Object(b.jsx)("button",{type:"submit",className:f()("button is-link",{"is-loading":F}),children:"Add"})}),Object(b.jsx)("div",{className:"control",children:Object(b.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:function(){c(""),l(!1),O(""),g(!1),P(""),L(!1),I(!1)},children:"Clear"})})]})]})},y=function(){var e=Object(i.useContext)(h),t=e.selectedPost,s=e.areCommentsLoading,c=e.isCommentsLoadingError,n=e.comments,a=e.setComments,o=e.isWritingComment,r=e.setIsWritingComment,l=t&&!s&&!c&&0===n.length,d=!s&&!o&&!c,j=function(e){var t,s=n;a((function(t){return t.filter((function(t){return t.id!==e.id}))})),(t=e.id,u("/comments/".concat(t))).catch((function(){a(s)}))};return Object(b.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(b.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(b.jsxs)("div",{className:"block",children:[Object(b.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===t||void 0===t?void 0:t.id,": ").concat(null===t||void 0===t?void 0:t.title)}),Object(b.jsx)("p",{"data-cy":"PostBody",children:null===t||void 0===t?void 0:t.body})]}),Object(b.jsxs)("div",{className:"block",children:[s&&Object(b.jsx)(N,{}),c&&Object(b.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"}),l&&Object(b.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),n.length>0&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("p",{className:"title is-4",children:"Comments:"}),n.map((function(e){return Object(b.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(b.jsxs)("div",{className:"message-header",children:[Object(b.jsx)("a",{href:"mailto:".concat(e.email),"data-cy":"CommentAuthor",children:e.name}),Object(b.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return j(e)},children:"delete button"})]}),Object(b.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)}))]}),d&&Object(b.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){return r(!0)},children:"Write a comment"})]}),o&&Object(b.jsx)(g,{})]})})},C=function(){var e=Object(i.useState)(!1),t=Object(a.a)(e,2),s=t[0],c=t[1],n=Object(i.useContext)(h),o=n.allUsers,r=n.selectedUser,l=n.setSelectedUser,d=n.setSelectedPost,j=function(e){var t=Object(i.useRef)(null);return Object(i.useEffect)((function(){var s=function(s){t.current&&!t.current.contains(s.target)&&e()};return document.addEventListener("mousedown",s),function(){document.removeEventListener("mousedown",s)}}),[e]),t}((function(){c(!1)}));return Object(b.jsxs)("div",{"data-cy":"UserSelector",className:f()("dropdown",{"is-active":s}),children:[Object(b.jsx)("div",{className:"dropdown-trigger",children:Object(b.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){c((function(e){return!e}))},children:[Object(b.jsx)("span",{children:(null===r||void 0===r?void 0:r.name)||"Choose a user"}),Object(b.jsx)("span",{className:"icon is-small",children:Object(b.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(b.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",ref:j,children:Object(b.jsx)("div",{className:"dropdown-content",children:o.map((function(e){return Object(b.jsx)("a",{href:"#user-".concat(e.id),className:f()("dropdown-item",{"is-active":e.id===(null===r||void 0===r?void 0:r.id)}),onClick:function(){return function(e){l(e),c(!1),d(null)}(e)},children:e.name},e.id)}))})})]})},S=function(){var e=Object(i.useContext)(h),t=e.selectedUser,s=e.arePostsLoading,c=e.isPostsLoadingError,n=e.posts,a=e.selectedPost,o=t&&0===n.length&&!s&&!c;return Object(b.jsx)("main",{className:"section",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsxs)("div",{className:"tile is-ancestor",children:[Object(b.jsx)("div",{className:"tile is-parent",children:Object(b.jsxs)("div",{className:"tile is-child box is-success",children:[Object(b.jsx)("div",{className:"block",children:Object(b.jsx)(C,{})}),Object(b.jsxs)("div",{className:"block","data-cy":"MainContent",children:[!t&&Object(b.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),s&&Object(b.jsx)(N,{}),c&&Object(b.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}),o&&Object(b.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"}),n.length>0&&Object(b.jsx)(v,{})]})]})}),Object(b.jsx)("div",{"data-cy":"Sidebar",className:f()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":a}),children:a&&Object(b.jsx)("div",{className:"tile is-child box is-success ",children:Object(b.jsx)(y,{})})})]})})})};n.a.render(Object(b.jsx)(O,{children:Object(b.jsx)(S,{})}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.c0622b3e.chunk.js.map